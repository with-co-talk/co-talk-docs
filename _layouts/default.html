<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
    
    <!-- SEO -->
    {% seo %}
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ '/assets/favicon.svg' | relative_url }}">
    
    <!-- Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- KaTeX for math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Mermaid for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    
    <!-- PlantUML -->
    <script src="https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js"></script>
  </head>
  <body>
    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="{{ site.baseurl }}/" class="logo">
          <span class="logo-icon">ğŸ’¬</span>
          <span class="logo-text">Co-Talk</span>
        </a>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">ì‹œì‘í•˜ê¸°</div>
          <ul class="nav-list">
            <li><a href="{{ site.baseurl }}/" class="nav-link {% if page.url == '/' %}active{% endif %}">í™ˆ</a></li>
            <li><a href="{{ site.baseurl }}/PRD" class="nav-link {% if page.url contains '/PRD' %}active{% endif %}">PRD</a></li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">ì•„í‚¤í…ì²˜</div>
          <ul class="nav-list">
            <li><a href="{{ site.baseurl }}/architecture/" class="nav-link {% if page.url == '/architecture/' or page.url == '/architecture/index.html' %}active{% endif %}">ê°œìš”</a></li>
            <li><a href="{{ site.baseurl }}/architecture/backend" class="nav-link {% if page.url contains '/architecture/backend' %}active{% endif %}">â”” Backend</a></li>
            <li><a href="{{ site.baseurl }}/architecture/frontend" class="nav-link {% if page.url contains '/architecture/frontend' %}active{% endif %}">â”” Frontend</a></li>
            <li><a href="{{ site.baseurl }}/architecture/database" class="nav-link {% if page.url contains '/architecture/database' %}active{% endif %}">â”” Database</a></li>
            <li><a href="{{ site.baseurl }}/architecture/api" class="nav-link {% if page.url contains '/architecture/api' %}active{% endif %}">â”” API</a></li>
            <li><a href="{{ site.baseurl }}/architecture/infrastructure" class="nav-link {% if page.url contains '/architecture/infrastructure' %}active{% endif %}">â”” Infrastructure</a></li>
            <li><a href="{{ site.baseurl }}/ARCHITECTURE-SCALE" class="nav-link {% if page.url contains '/ARCHITECTURE-SCALE' %}active{% endif %}">Scale (ëŒ€ê·œëª¨)</a></li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">API Reference</div>
          <ul class="nav-list">
            <li><a href="{{ site.baseurl }}/api/" class="nav-link {% if page.url == '/api/' or page.url == '/api/index.html' %}active{% endif %}">API Overview</a></li>
            <li><a href="{{ site.baseurl }}/api/API_AUTH" class="nav-link {% if page.url contains '/api/API_AUTH' %}active{% endif %}">â”” Auth API</a></li>
            <li><a href="{{ site.baseurl }}/api/API_USER" class="nav-link {% if page.url contains '/api/API_USER' %}active{% endif %}">â”” User API</a></li>
            <li><a href="{{ site.baseurl }}/api/API_FRIEND" class="nav-link {% if page.url contains '/api/API_FRIEND' %}active{% endif %}">â”” Friend API</a></li>
            <li><a href="{{ site.baseurl }}/api/API_CHATROOM" class="nav-link {% if page.url contains '/api/API_CHATROOM' %}active{% endif %}">â”” Chat Room API</a></li>
            <li><a href="{{ site.baseurl }}/api/API_MESSAGE" class="nav-link {% if page.url contains '/api/API_MESSAGE' %}active{% endif %}">â”” Message API</a></li>
            <li><a href="{{ site.baseurl }}/api/API_NOTIFICATION" class="nav-link {% if page.url contains '/api/API_NOTIFICATION' %}active{% endif %}">â”” Notification API</a></li>
            <li><a href="{{ site.baseurl }}/api/API_ADMIN" class="nav-link {% if page.url contains '/api/API_ADMIN' %}active{% endif %}">â”” Admin API</a></li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">ê¸°ìˆ  ìŠ¤íƒ</div>
          <ul class="nav-list">
            <li><a href="{{ site.baseurl }}/tech-stack/" class="nav-link {% if page.url == '/tech-stack/' or page.url == '/tech-stack/index.html' %}active{% endif %}">ê°œìš”</a></li>
            <li><a href="{{ site.baseurl }}/tech-stack/backend" class="nav-link {% if page.url contains '/tech-stack/backend' %}active{% endif %}">â”” Backend</a></li>
            <li><a href="{{ site.baseurl }}/tech-stack/frontend" class="nav-link {% if page.url contains '/tech-stack/frontend' %}active{% endif %}">â”” Frontend</a></li>
            <li><a href="{{ site.baseurl }}/tech-stack/infrastructure" class="nav-link {% if page.url contains '/tech-stack/infrastructure' %}active{% endif %}">â”” Infrastructure</a></li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">ê¸°ìˆ  ê²°ì • (ADR)</div>
          <ul class="nav-list">
            <li><a href="{{ site.baseurl }}/decisions/" class="nav-link {% if page.url == '/decisions/' or page.url == '/decisions/index.html' %}active{% endif %}">ëª©ë¡</a></li>
            <li><a href="{{ site.baseurl }}/decisions/msa-vs-monolith" class="nav-link {% if page.url contains '/decisions/msa-vs-monolith' %}active{% endif %}">â”” MSA vs Monolith</a></li>
            <li><a href="{{ site.baseurl }}/decisions/database-selection" class="nav-link {% if page.url contains '/decisions/database-selection' %}active{% endif %}">â”” Database</a></li>
            <li><a href="{{ site.baseurl }}/decisions/spring-mvc-vs-webflux" class="nav-link {% if page.url contains '/decisions/spring-mvc-vs-webflux' %}active{% endif %}">â”” MVC vs WebFlux</a></li>
            <li><a href="{{ site.baseurl }}/decisions/redis-streams-ordering" class="nav-link {% if page.url contains '/decisions/redis-streams-ordering' %}active{% endif %}">â”” Redis Streams</a></li>
            <li><a href="{{ site.baseurl }}/decisions/frontend-platform-strategy" class="nav-link {% if page.url contains '/decisions/frontend-platform-strategy' %}active{% endif %}">â”” Platform Strategy</a></li>
            <li><a href="{{ site.baseurl }}/decisions/flutter-vs-react-native" class="nav-link {% if page.url contains '/decisions/flutter-vs-react-native' %}active{% endif %}">â”” Flutter vs RN</a></li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">ê°€ì´ë“œ</div>
          <ul class="nav-list">
            <li><a href="{{ site.baseurl }}/guides/diagram-guide" class="nav-link {% if page.url contains '/guides/diagram-guide' %}active{% endif %}">ë‹¤ì´ì–´ê·¸ë¨ ê°€ì´ë“œ</a></li>
          </ul>
        </div>
      </nav>
      
      <div class="sidebar-footer">
        <a href="https://github.com/with-co-talk/co-talk" class="github-link" target="_blank">
          GitHub
        </a>
      </div>
    </aside>
    
    <!-- ëª¨ë°”ì¼ í—¤ë” -->
    <header class="mobile-header">
      <button class="menu-toggle" id="menuToggle" aria-label="ë©”ë‰´ ì—´ê¸°">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="{{ site.baseurl }}/" class="mobile-logo">Co-Talk</a>
    </header>
    
    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
      <article class="content">
        {{ content }}
      </article>
    </main>
    
    <!-- ëª¨ë°”ì¼ ì˜¤ë²„ë ˆì´ -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Scripts -->
    <script>
      // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
      const menuToggle = document.getElementById('menuToggle');
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      
      menuToggle.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        overlay.classList.toggle('open');
        document.body.classList.toggle('sidebar-open');
      });
      
      overlay.addEventListener('click', () => {
        sidebar.classList.remove('open');
        overlay.classList.remove('open');
        document.body.classList.remove('sidebar-open');
      });
    </script>
    
    <!-- Initialize Mermaid -->
    <script>
      mermaid.initialize({ 
        startOnLoad: false,
        theme: 'neutral',
        themeVariables: {
          primaryColor: '#e8e8e8',
          primaryTextColor: '#333',
          primaryBorderColor: '#ccc',
          lineColor: '#666',
          secondaryColor: '#f4f4f4',
          tertiaryColor: '#fff'
        }
      });
      document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('pre code.language-mermaid').forEach(function(block) {
          var div = document.createElement('div');
          div.className = 'mermaid';
          div.textContent = block.textContent;
          block.closest('pre').replaceWith(div);
        });
        mermaid.run().catch(function(e) {
          console.error('Mermaid ë Œë”ë§ ì‹¤íŒ¨:', e);
        });
      });
    </script>
    
    <!-- Initialize KaTeX -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\[", right: "\\]", display: true},
            {left: "\\(", right: "\\)", display: false}
          ],
          throwOnError: false
        });
      });
    </script>
    
    <!-- Initialize PlantUML -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // PlantUML ì½”ë“œ ë¸”ë¡ ì°¾ê¸° (language-plantuml ë˜ëŠ” language-puml)
        document.querySelectorAll('pre code.language-plantuml, pre code.language-puml').forEach(function(block) {
          try {
            const plantumlCode = block.textContent;
            const encoded = plantumlEncoder.encode(plantumlCode);
            const img = document.createElement('img');
            img.src = 'https://www.plantuml.com/plantuml/svg/' + encoded;
            img.alt = 'PlantUML Diagram';
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
            
            const container = document.createElement('div');
            container.className = 'plantuml-diagram';
            container.appendChild(img);
            
            block.closest('pre').replaceWith(container);
          } catch (e) {
            console.error('PlantUML ë Œë”ë§ ì‹¤íŒ¨:', e);
          }
        });
        
        // @startumlë¡œ ì‹œì‘í•˜ëŠ” ì½”ë“œ ë¸”ë¡ë„ ì²˜ë¦¬
        document.querySelectorAll('pre code').forEach(function(block) {
          const code = block.textContent.trim();
          if (code.startsWith('@startuml') || code.startsWith('@startmindmap') || code.startsWith('@startwbs')) {
            try {
              const encoded = plantumlEncoder.encode(code);
              const img = document.createElement('img');
              img.src = 'https://www.plantuml.com/plantuml/svg/' + encoded;
              img.alt = 'PlantUML Diagram';
              img.style.maxWidth = '100%';
              img.style.height = 'auto';
              
              const container = document.createElement('div');
              container.className = 'plantuml-diagram';
              container.appendChild(img);
              
              block.closest('pre').replaceWith(container);
            } catch (e) {
              console.error('PlantUML ë Œë”ë§ ì‹¤íŒ¨:', e);
            }
          }
        });
      });
    </script>
  </body>
</html>
